- [General Concept](#general-concept)
  - [Example](#example)
- [Detection](#detection)
- [Prevention](#prevention)

# General Concept
Cross-site request forgery is a vulnerability that allows attackers to induce users to perform
actions they don't intend to perform. It will enable partial circumvention of the same origin policy
that prevents sites from interfering with each other. 

In a successful attack, the victim unintentionally carries out an action, such as changing the email 
address on their account, changing their password, or transferring funds. The attacker might be able to gain
full control over the user's account, and if that account is privileged, the full application. 

There are three conditions that enable a CSRF attack:
- **Relevant action.** There needs to be an action within the app that the attacker has a reason to induce.
- **Cookie-based session handling.** Performing the action needs to involve issuing 1+ HTTP requests, and the
  application relies solely on session cookies to id the user who made the request. 
- **No unpredictable request parameters.** The requests that perform the action can't contain parameters
  whose values the attacker can't determine/guess. 

## Example
Suppose there is an app that has a function for the user to change the email address for their account. 
When the user performs this action, they make an HTTP request like the following:

```
POST /email/change HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30
Cookie: session=asdfghjkl

email=weiner@normal-user.com
```
Then the attacker can construct a web page with the following HTML:

```
<html>
    <body>
        <form action="https://vulnerable-website.com/email/change" method="POST">
            <input type="hidden" name="email" value="pwned@evil-user.net" />
        </form>
        <script>
            document.forms[0].submit();
        </script>
    </body>
</html>
```
If a user visits the attacker's webpage, then:
- The attacker's page will trigger an HTTP request to the vulnerable site
- If the user is logged on the vulnerable site, their browser will auto-include their session cookie in
  the request (assuming SameSite cookies aren't being used)
- The vulnerable website will process the request the normal way, treating it as though it were made by
  the victim, and change their email address

Note that CSRF is normally talked about concerning cookie-based session handling, but it also 
comes up in other contexts where the app auto adds some user credentials to requests, like 
HTTP Basic auth and certificate-based auth. 

# Detection

# Prevention
